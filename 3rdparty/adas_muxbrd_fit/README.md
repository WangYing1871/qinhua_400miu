# adas_muxbrd_fit 说明

## 模式一：计算各层的位置分辨率、效率等

参考如下命令

![image-20240707191738886](./reademe.assets/image-20240707191738886.png)

1、首先需要输入待处理的root文件 -f 只能处理root文件

其中root文件包含的内容为

- 触发号 trigid
- 总的探测器层数 total_layer_num
- 每一层探测器的信息，包括x、y击中簇团数、电荷重心法击中目标、沉积电荷量

2、输入总共探测的层数 -l

3、因为要一层一层处理 所以 -u 代表不连续

4、要处理哪层就 -v i  ps：-v 0 就代表利用其他层获得第0层的位置分辨率效率等

5、-a 代表对探测器进行位置修正

- ![image-20240707192703348](./reademe.assets/image-20240707192703348.png)

- 第一行是x维度修正，第二行y维度，第三行y维度
- 每一列代表一层，上述图片就是一共6层的修正，从左到右代表从detector【0】~detector【5】
- 没有修正参数就根据情况填0即可
- 这个文件必须要有！！！

6、拟合优度rmse卡的值 -r 1

- 代表只有各层拟合直线的rmse小于等于1，这次事例才算有效事例

7、位置分辨允许误差 -g 4.6

- 因为会算拟合的位置和电子学测到的击中位置之差作为deltax，然后再进行位置分辨率画图，因此需要卡一个sigma

8、探测器击中范围文件（需要保证击中位置在探测器范围内才有效）detector_hitrange.txt

![image-20240707193657836](./reademe.assets/image-20240707193657836.png)

- 这代表x维度范围为0.4~153.6 mm
- y维度范围也是0.4~153.6 mm

9、LSB（-L ）  ADC码值，如果你的map值就是电荷量这里设置为1即可

其余一般保持我程序默认值即可

### 程序计算流程

![image-20240707194226868](./reademe.assets/image-20240707194226868.png)

1、首先读取root文件（-f）、相应的修正文件（-a）、和探测器范围文件，如果要使用此程序，root文件的branch需要跟我保持一致。root文件名需要是run- （因为之前为了输出json文件）

2、接着创建一个txt，后续txt会输出每一层对应位置分辨率、效率和朗道拟合宇宙线缪子沉积能量等 

3、convert.... 这个就是把探测器信息整理一下

4、run为主要的操作部分，先处理x维度在处理y维度

以先处理第0层数据为例，假设一共6层

包括data_select：把此次事例第0层的数据挑出来，其余五层的数据排列组合（因为可能有一层有两个有效簇团，这样就有多种可能性需要排列组合

data_fit：将每种组合拟合，选择拟合优度最高的那个组合，反推获得第0层的拟合击中位置等信息

filterAndCombine：这个是挑选x和y维度都需要有的事例才算有效事例。（之前这样算的分辨率，后面感觉并不需要，因因此并没有用到）

writeSpatial：这个就是将之前每个事例对应第0层信息和拟合信息进行计算，获得效率、位置分辨率。并且进行画图

结束







